# set current environment
CURRENT_ENV="laptop"
if [ -f "$HOME/.current_env" ]; then
    CURRENT_ENV="$(cat $HOME/.current_env)"
fi
export CURRENT_ENV

# desktop background
/usr/bin/feh --bg-scale ~/.background/amami.jpg

# ime env vars
export XIM=ibus
export GTK_IM_MODULE="ibus"
export QT_IM_MODULE="ibus"
export XMODIFIERS="@im=ibus"

# keyring
dbus-update-activation-environment --systemd DISPLAY
eval $(/usr/bin/gnome-keyring-daemon --start --components=pkcs11,secrets,ssh)
export SSH_AUTH_SOCK

# keyboard setup
setxkbmap -layout us,fr,es -option grp_led:scroll,terminate:ctrl_alt_bksp
xmodmap ~/.xmodmaps/swap_colon_semicolon
xmodmap ~/.xmodmaps/map_alt_to_zenkaku

# When using note keyboard
grep -E "(PFU|HHKB)" /proc/bus/input/devices > /dev/null
if [ $? -eq 1 ]; then
    xmodmap ~/.xmodmaps/remap_capslock_to_ctrl
fi

# mouse setup
xset -dpms
xset s off
xsetroot -cursor_name left_ptr

# display setup
if [ "$CURRENT_ENV" = "lab" ]; then
    [ -f ~/.xorg/lab.sh ] && . ~/.xorg/lab.sh
elif [ "$CURRENT_ENV" = "office" ]; then
    [ -f ~/.xorg/office.sh ] && . ~/.xorg/office.sh
elif [ "$CURRENT_ENV" = "home" ]; then
    [ -f ~/.xorg/home.sh ] && . ~/.xorg/home.sh
else
  xrandr --auto
fi

# set Xresources
[[ -f ~/.Xresources ]] && xrdb -merge ~/.Xresources

# start applications
systemctl --user import-environment XDG_SESSION_PATH
systemctl --user start user-applications.target
